/* typation.js - v0.2.1 - 2013
 * --
 * Distributed under MIT License:
 * Copyright (c) 2013 Guglielmo Cassinelli
 */
(function(c){var b={init:function(a){typ=this;typ.settings=c.extend({to_type:"",begin_delay:1E3,min_type_delay:50,max_type_delay:100,min_found_delay:300,max_found_delay:800,min_pause_delay:200,max_pause_delay:600,cursor_blink:600,cursor_color:"#DAD085",error_prob:0.01,find_error_prob:0.25,pause_prob:0.03,updateCallback:function(){},endCallback:function(){}},a);typ.error_map={1:"2q",2:"1qw3",3:"2we4",4:"3er5",5:"4rt6",6:"5ty7",7:"6yu8",8:"7ui9",9:"8io0",0:"9op",q:"12wa",w:"q23esa",e:"w34rds",r:"e45tfd",
t:"r56ygf",y:"t67uhg",u:"y78ijh",i:"u89okj",o:"i90plk",p:"o0l",a:"qwsz",s:"awedxz",d:"serfcx",f:"drtgvc",g:"ftyhbv",h:"gyujnb",j:"huikmn",k:"jiolm",l:"kop",z:"asx",x:"zsdc",c:"xdfv",v:"cfgb",b:"vghn",n:"bhjm",m:"njk"};typ.States={TYPING:1,CORRECTING:2,STOP:3};typ.Ops={TYPE:1,PAUSE:2,ERROR:3,ERRFOUND:4};typ.Errors={INSERT:1,DELETE:2};Object.freeze&&(Object.freeze(typ.States),Object.freeze(typ.Ops));typ.curr_state=typ.States.TYPING;typ.typed_count=0;typ.ffwd=!1;typ.str_typed="";typ.str_to_type=typ.settings.to_type;
typ.errors=[];b.createCursor();typ.beginTimeout=setTimeout(b.update,typ.settings.begin_delay);return at},append:function(a){typ.str_to_type+=a;typ.curr_state==typ.States.STOP&&(typ.curr_state=typ.States.TYPING,typ.beginTimeout=setTimeout(b.update,typ.settings.begin_delay),typ.cursorBlinking||b.cursorBlink())},update:function(){typ.curr_state==typ.States.CORRECTING?b.correct():0!=typ.errors.length&&Math.random()<typ.settings.find_error_prob?(typ.curr_state=typ.States.CORRECTING,b.updateDelay("found")):
0!=typ.str_to_type.length?Math.random()<typ.settings.error_prob?b.makeError():Math.random()<typ.settings.pause_prob?b.updateDelay("pause"):(b.typeChar(),b.updateDelay("typed")):(typ.curr_state=typ.States.STOP,c.isFunction(typ.settings.endCallback)&&typ.settings.endCallback.call())},correct:function(){for(var a=typ.errors.length-1;0<=a;a--)typ.errors[a].pos==typ.typed_count&&(typ.str_to_type=typ.errors[a].err==typ.Errors.INSERT?typ.str_to_type.substr(1):typ.errors[a].character+typ.str_to_type,typ.errors.splice(a,
1));0==typ.errors.length?typ.curr_state=typ.States.TYPING:(typ.$cursor.remove(),a=typ.str_typed.charAt(typ.str_typed.length-1),typ.str_typed=typ.str_typed.substr(0,typ.str_typed.length-1),typ.str_to_type=a+typ.str_to_type,typ.typed_count--,typ.text(typ.str_typed),typ.append(typ.$cursor));b.updateDelay("typed")},makeError:function(){if(0.5>Math.random()){var a=typ.str_typed.charAt(typ.str_typed.length-1),a=a.toLowerCase();typ.error_map[a]&&(a=typ.error_map[a],a=a.charAt(Math.floor(Math.random()*a.length)),
typ.errors.push({err:typ.Errors.INSERT,pos:typ.typed_count}),typ.str_to_type=a+typ.str_to_type)}else a=typ.str_to_type.charAt(0),typ.errors.push({err:typ.Errors.DELETE,pos:typ.typed_count,character:a}),typ.str_to_type=typ.str_to_type.substr(1);b.typeChar();b.updateDelay("error")},skip:function(){if(typ.curr_state!=typ.States.STOP)return b.clearTimers(),typ.$cursor.remove(),typ.append(typ.str_to_type),typ.str_typed+=typ.str_to_type,typ.str_to_type="",typ.append(typ.$cursor),typ.curr_state=typ.States.STOP,
c.isFunction(typ.settings.endCallback)&&typ.settings.endCallback.call(),at},ffwd:function(){typ.curr_state!=typ.States.STOP&&(typ.ffwd=!0,b.clearTimers(),typ.settings=c.extend(typ.settings,{begin_delay:0,min_type_delay:0,max_type_delay:0}),b.update())},consumeChar:function(a){a=typ.str_to_type.charAt(0);typ.str_to_type=typ.str_to_type.substr(1);return a},typeChar:function(){var a=b.consumeChar();typ.str_typed+=a;typ.typed_count++;typ.$cursor.remove();typ.append(a);typ.append(typ.$cursor)},clearTimers:function(){clearTimeout(typ.finalTimeout);
clearTimeout(typ.beginTimeout);clearTimeout(typ.charTimeout)},updateDelay:function(a){var d,e;switch(a){case "typed":case "error":d=typ.settings.min_type_delay;e=typ.settings.max_type_delay;break;case "found":d=typ.settings.min_found_delay;e=typ.settings.max_found_delay;break;case "pause":d=typ.settings.min_pause_delay,e=typ.settings.max_pause_delay}interval=typ.ffwd?0:b.randomBetween(d,e);typ.charTimeout=setTimeout(b.update,interval);c.isFunction(typ.settings.updateCallback)&&typ.settings.updateCallback.call()},
createCursor:function(){typ.append('<span id="at-cursor">|</span>');typ.$cursor=c("#at-cursor");typ.$cursor.isVisible=!0;typ.$cursor.css({"font-family":"arial,sans-serif",color:typ.settings.cursor_color,"line-height":"0.9em"});b.cursorBlink()},cursorBlink:function(){typ.cursorBlinking=!0;typ.cursor_interval=setInterval(function(){typ.$cursor.isVisible?typ.$cursor.css("visibility","hidden"):typ.$cursor.css("visibility","visible");typ.$cursor.isVisible=!typ.$cursor.isVisible},typ.settings.cursor_blink)},
clearCursor:function(){typ.cursorBlinking=!1;clearInterval(typ.cursor_interval);typ.$cursor.remove()},randomBetween:function(a,b){return Math.round(Math.random()*(b-a)+a)}};c.fn.typation=function(a){if(b[a])return b[a].apply(this,Array.prototype.slice.call(arguments,1));if("object"!==typeof a&&a)c.error("Method "+a+" does not exist on jQuery.typation");else return b.init.apply(this,arguments)}})(jQuery);
